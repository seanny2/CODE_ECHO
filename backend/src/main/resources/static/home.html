<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>코드 에코</title>
    <link rel="icon" href="data:image/png;base64,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" type="image/x-icon">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    
  <link rel="stylesheet" href="/assets/home.e9410cae.css">
</head>

<body>
    <div id="main">
        <div id="title">프로그래머를 위한<br /> 코드 공동 편집 서비스</div>
        <div id="subtitle">누구나 실시간으로 코드 동시 편집과 채팅을 즐길 수 있도록 설계하였습니다.</div>
        <div id="service">
            <div id="button-group">
                <p class="d-inline-flex gap-1">
                    <a class="btn btn-primary" data-bs-toggle="collapse" href="#create-room-btn" role="button"
                        aria-expanded="false" aria-controls="create-room-btn">
                        새 회의
                    </a>
                </p>
                <div class="enter-wrap input-group">
                    <input id="link-input" type="text" aria-label="First name" class="form-control" placeholder="코드 입력">
                    <input id="name-input1" type="text" aria-label="Last name" class="form-control"
                        placeholder="닉네임 입력">
                    <button id="enter" class="service_btn">게스트로 참가</button>
                </div>
            </div>
            <div class="collapse" id="create-room-btn">
                <div class="split-line"></div>
                <h4 style="margin-top: 30px;">호스트로 참가하기</h4>
                <div style="max-width: 350px;">
                    <div id="create-uuid" class="input-group mb-3">
                        <input id="print-uuid" type="text" class="form-control" placeholder="코드를 생성하세요"
                            aria-label="Recipient's username" aria-describedby="create-uuid-btn" disabled>
                        <button id="create-uuid-btn" class="service_btn">코드 생성</button>
                    </div>
                    <div id="create-nickname" class="input-group mb-3">
                        <input id="name-input2" type="text" class="form-control" placeholder="닉네임을 입력하세요"
                            aria-label="Recipient's username" aria-describedby="start">
                        <button class="service_btn" id="start">확인</button>
                    </div>
                </div>

            </div>
        </div>
        <div class="split-line"></div>
        <div id="support">계정이 없나요? <span>지금 시작하세요</span></div>
    </div>
    <script>
        $(document).ready(function () {
            // 현재 URL에서 query string을 가져오는 함수
            function getQueryString() {
                var queryString = window.location.search.slice(1);
                var pairs = queryString.split('&');
                var params = {};
                pairs.forEach(function (pair) {
                    pair = pair.split('=');
                    params[pair[0]] = decodeURIComponent(pair[1] || '');
                });
                return params;
            }

            // query string에서 roomid와 nickname 추출
            var queryParams = getQueryString();
            var roomid = queryParams.roomid ?? "";
            var nickname = queryParams.nickname ?? "";

            document.getElementById("name-input1").value = nickname;
            document.getElementById("link-input").value = roomid;

            $("#start").click(function () {
                var roomId = document.getElementById("print-uuid").value;
                var nickname = document.getElementById("name-input2").value;
                console.log()
                if (roomId === "") {
                    alert("코드를 생성하세요");
                    return;
                }
                if (nickname === "") {
                    alert("닉네임을 입력하세요");
                    return;
                }
                $.ajax({
                    type: "POST",
                    url: "http://localhost:8083/create",
                    contentType: "application/json",
                    data: JSON.stringify({
                        id: roomId
                    }),
                    success: function (response) {
                        sessionStorage.setItem('userId', nickname);
                        console.log(`[${roomId}] 방을 생성하였습니다.`);
                        window.location.href = `http://localhost:8083/${roomId}`;
                    },
                    error: function (error) {
                        console.log(`[${roomId}] 방을 생성할 수 없습니다!.`);
                    }
                });
            });
            $("#enter").click(function () {
                sessionStorage.setItem('userId', document.getElementById("name-input1").value);
                window.location.href = "http://localhost:8083/" + document.getElementById("link-input").value;
            });

            $("#create-uuid-btn").click(function () {
                document.getElementById("print-uuid").value = get_uuid();
            })

        });

        function get_uuid() {
            const crypto = window.crypto || window.msCrypto;
            if (crypto && crypto.getRandomValues) {
                const buffer = new Uint16Array(4);
                crypto.getRandomValues(buffer);
                return (
                    buffer[0].toString(16) +
                    '-' +
                    buffer[1].toString(16) +
                    '-' +
                    buffer[2].toString(16)
                );
            } else {
                console.error('crypto.getRandomValues() is not supported in this browser.');
                return null;
            }
        }
    </script>
</body>

</html>